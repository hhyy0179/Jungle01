<!DOCTYPE html>
<html lang = "en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
            integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

        <!-- Optional JavaScript -->
        <!-- jQuery and Bootstrap Bundle (includes Popper) -->
        <script
            src="https://code.jquery.com/jquery-3.6.0.js"
            type="text/javascript"></script>

        <!-- ì•„ë˜ ì½”ë“œ íŒŒì¼ ì‹¤í–‰ ì‹œ, ajax ì‹¤í–‰ ì•ˆë¨. -->
        <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>-->

        <!-- ajax ì‹¤í–‰ ë¨. -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
            crossorigin="anonymous"></script>

        <title>ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„ ë§Œë“¤ê¸°</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">

        <!-- <link rel="stylesheet" href = "{{ url_for('static', filename ='css/movie_style.css') }}"> -->


        <style>
            * {
                font-family: 'IBM Plex Sans KR', sans-serif;
            }

            .wrap {
                width: 1000px;
                margin: 10px auto;
            }

            .content{
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            #cards-box {
                display: block;
            }

            .title {
                text-align: center;
                padding: 40px;
                background-color: rgb(255, 207, 49);
            }

            .title > h1 {
                font-weight: bold;
            }

            .card-title {
                font-weight: bold;
            }

            .col-md-5 {
                
                margin: 50px auto 50px auto;
            }

            .top-btn-group {
                width: auto;
                margin: 20px auto 20px auto;
                display: flex;
                flex-direction: column;
            }
            
            .detail-btn-group{
                display: flex;
                flex-direction: row;
            }

            .view-trash{
                width: 100%;
                display: flex;
                justify-content: flex-end;
                margin-top: 10px;
            }

            #cards-box {
                justify-content: center;
            }

            a {
                display: inline-block;
                color: inherit;
                color: black;
                font-weight: bold;
            }

            #movie-title:hover {
                text-decoration: underline;
            }

            #thumbs_up {
                background-color: none;
                color: blue;
            }

            #goto_trashcan {
                color: red;
            }

            #btn-trashcan {
                color: rgb(93, 188, 125);
                background : none;
                border: none;
            }

        </style>

        <script>

            const Sort = {
                BY_LIKES: "likes",
                BY_VIEWERS: "viewers",
                BY_DATE: "open_date",
            };

            let sortMode = Sort.BY_LIKES
            let trashMode = false

            $(document).ready(function () {
                // ì˜í™” ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
                displaySorter()

                showMovies()


            });

            function showMovies() {
                $('#cards-box').empty()

                if (trashMode == false) {
                    $.ajax({
                        type: "GET",
                        url: "/movies/list",
                        data: {'sortMode': sortMode},
                        success: function(response){
                            let movies = response["movies_list"];
                            for(let i = 0; i < movies.length; i++)
                            {
                                console.log(movies[i]);
                                makeCard(movies[i]["title"],movies[i]["open_date"],movies[i]["viewers"],movies[i]["info_url"],movies[i]["poster_url"],movies[i]["likes"])
                            }
                        }
                    })

                } else {
                    $.ajax({
                        type: "GET",
                        url: "/movies/trashedlist",
                        data: {'sortMode': sortMode},
                        success: function(response){
                            let movies = response["movies_list"];
                            for(let i = 0; i < movies.length; i++)
                            {
                                console.log(movies[i]);
                                makeTrashedCard(movies[i]["title"],movies[i]["open_date"],movies[i]["viewers"],movies[i]["info_url"],movies[i]["poster_url"],movies[i]["likes"])
                            }
                        }
                    })

                }
            }

            function makeCard(title, open_date, viewers, info_url, poster_url, likes) {
                let formattedViewers = viewers.toLocaleString();
                let temp_html = `<div class="card mb-3" style="max-width: 540px;">
                                    <div class="row no-gutters">
                                        <div class="col-md-5">
                                            <img src="${poster_url}" alt="Card image cap">
                                        </div>
                                        <div class="col-md-5">
                                            <div class="card-body">
                                                <h5> <a href = "${info_url}" class="card-title" id= "movie_title" > ${title} </a></h5>
                                                <span class="icon"><i class="fas fa-thumbs-up"></i></span><span class="movie-likes"> ğŸ‘ ${likes}</span>
                                                <p class="viewers"> ëˆ„ì ê´€ê°ìˆ˜ ${formattedViewers}ëª… </p>
                                                <p class="open_date">ê°œë´‰ì¼ ${open_date} </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-navy navbar-btn find-btn1" id="thumbs_up" onclick="likeMovie('${title}')" > ğŸ‘ ìœ„ë¡œ! </button>
                                        <button type="button"  class="btn btn-navy navbar-btn find-btn1"  id="goto_trashcan"onclick="trashMovie('${title}')"  >  ğŸ—‘ íœ´ì§€í†µìœ¼ë¡œ! </button>
                                    </div>
                                </div>`;
                                
                $('#cards-box').append(temp_html);
            }   

            function makeTrashedCard(title, open_date, viewers, info_url,  poster_url, likes) {
                let formattedViewers = viewers.toLocaleString();
                let temp_html = `<div class="card mb-3" style="max-width: 540px;">
                                    <div class="row no-gutters">
                                        <div class="col-md-5">
                                            <img src="${poster_url}" alt="Card image cap">
                                        </div>
                                        <div class="col-md-5">
                                            <div class="card-body">
                                                <h5 href = "${info_url}" class="card-title" id= "movie_title" > ${title} </h5>
                                                <span class="icon"><i class="fas fa-thumbs-up"></i></span><span class="movie-likes"> ğŸ‘ ${likes}</span>
                                                <p class="viewers"> ëˆ„ì ê´€ê°ìˆ˜ ${formattedViewers}ëª… </p>
                                                <p class="open_date">ê°œë´‰ì¼ ${open_date} </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-navy navbar-btn find-btn1" onclick="trashMovie('${title}')" > ë³µêµ¬í•˜ê¸° </button>
                                        <button type="button" class="btn btn-grey navbar-btn find-btn1" onclick="DeleteMovie('${title}')"  > ì˜êµ¬ì‚­ì œ </button>
                                    </div>
                                </div>`;
                                
                $('#cards-box').append(temp_html);
            }   

            function changeSorter(newMode) {
                if (sortMode == newMode) {
                    return
                }

                sortMode = newMode
                displaySorter()
                showMovies()
            }

            // ì •ë ¬ ê¸°ì¤€ì— ë”°ë¼ í•´ë‹¹ ë²„íŠ¼ë§Œ í™œì„±í™” ì‹œí‚¤ê³  ë‹¤ë¥¸ ë²„íŠ¼ì€ ë¹„í™œì„±í™” ì‹œí‚´
            function displaySorter() {
                document.getElementById("sorter-likes").classList.remove("active")
                document.getElementById("sorter-viewers").classList.remove("active")
                document.getElementById("sorter-date").classList.remove("active")
            }


            function likeMovie(title) {
                $.ajax({
                    type: "POST",
                    url: "/movies/like",
                    data: {like_movie_give: title},
                    success: function (response) {
                        if (response['result'] == 'success') {
                            // 2. 'ì¢‹ì•„ìš” ì™„ë£Œ!' ì–¼ëŸ¿ì„ ë„ì›ë‹ˆë‹¤.
                            alert('ì¢‹ì•„ìš” ì™„ë£Œ!')
                            // 3. ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
                            showMovies()
                        } else {
                            alert('ì¢‹ì•„ìš” ì‹¤íŒ¨ã… ã… ')
                        }
                    }
                });
            }

            function trashMovie(title) {
                $.ajax({
                    type: "POST",
                    url: "/movies/trash",
                    data: {trash_give: title},
                    success: function (response) {
                        if (response['result'] == 'success' ) {
                            if(response['trashed'] == true )
                                alert('íœ´ì§€í†µ ë³´ë‚´ê¸° ì™„ë£Œ!')
                            else
                                alert('íœ´ì§€í†µ ë³µêµ¬ ì™„ë£Œ!')
                            // 3. ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
                            showMovies()
                        } else {
                            alert('ì‹¤íŒ¨ã… ã… ')
                        }
                    }
                });
            }

            function displayTrashList()
            {
                if(trashMode == false) {
                    trashMode = true
                    //trashedê°€ true ì¸ê²ƒë“¤ë§Œ ë³´ì—¬ì¤Œ 
                    showMovies()
                    $('#btn-trashcan').text('ğŸ—‘ íœ´ì§€í†µ ë‹«ê¸°')
                }
                else  //status = 'none'
                {
                    trashMode = false
                     //trashedê°€ false ì¸ê²ƒë“¤ë§Œ ë³´ì—¬ì¤Œ 
                    showMovies()
                    $('#btn-trashcan').text('ğŸ—‘  íœ´ì§€í†µ ë³´ê¸°')
                }
            }

            function DeleteMovie(title) {
                $.ajax({
                    type: "POST",
                    url: "/movies/delete",
                    data: {delete_give: title},
                    success: function (response) {
                        if (response['result'] == 'success' ) {
                            alert('ì˜êµ¬ ì‚­ì œ ì™„ë£Œ!')
                            showMovies()
                        } else {
                            alert('ì‹¤íŒ¨ã… ã… ')
                        }
                    }
                });
            }

        </script>
    </head>
     
    <body>
        <div class ="wrap">
            <div class="title">
                <h1> ëª¨ë‘ì˜ ëƒ‰ì¥ê³  </h1>
            </div>
            <div class = "content">
                <div class="top-btn-group" role="group" aria-label="sorting">
                    <div class = "detail-btn-group">
                        <button type="button" class="btn btn-primary" id="sorter-date" > ìµœì‹ ìˆœ </button>
                        <button type="button" class="btn btn-primary"  id="sorter-expiration " > ìœ í†µê¸°í•œ ë‚®ì€ ìˆœ  </button>
                        <button type="button" class="btn btn-primary"  id="sorter-count" > ê°œìˆ˜ ì ì€ ìˆœ </button>
                    </div>
                    <div class="view-trash">
                        <button id="btn-trashcan"  onclick="displayTrashList()">  ğŸ—‘ íœ´ì§€í†µ ë³´ê¸° </button>
                    </div>
                </div>
                <!-- <p>
                    <button class="view-trash" id="btn-trashcan"  onclick="displayTrashList()"> íœ´ì§€í†µ ë³´ê¸° </button>
                </p> -->
                <div id="cards-box" >
                </div>
            </div>
        </div>
    </body>
</html>